,GitCode
3951,"/* jshint unused: false */

/*
 * wijcollections - Abstract Collection
 * https://github.com/webinfluenza/wijcollections
 *
 * Copyright (c) 2013 Benno Mielke
 * Licensed under the MIT license.
 */

/**
 * Just an abstract definition
 */
define( ""wijcModules/private/AbstractCollection"", function() {
    /**
     * <h2><strong>Do not instanciate this one ever!</strong></h2>
     * Basic, abstract Class.
     *
     * @class AbstractCollection
     * @constructor
     */
    function AbstractCollection() {
        var MAX_ARRAY_LENGTH = Math.floor( (Math.pow( 2, 32 ) - 1) / 2 ),
            that = this;

        /**
         * Returns the maximum array length for the collections API.
         *
         * @protected
         * @method getMaxArrayLength
         * @return {Number} the maximum Array length
         */
        that.getMaxArrayLength = function() {
            return MAX_ARRAY_LENGTH;
        };

        /**
         * Using the Java hashCode function to generate a Integer hash code.
         *
         * @protected
         * @see http://stackoverflow.com/a/7616484
         * @method hashCode
         * @param  {String} str String representation of any object
         * @return {String}     hash code
         */
        that.hashCode = window.hashCode = function( str ) {
            var hash = 0, len = str.length;

            if( len === 0 ) {
                return hash;
            }

            for( var i = 0; i < len; i++ ) {
                hash = ( (hash << 5) - hash ) + str.charCodeAt( i );
                hash = hash & hash; // Convert to 32bit integer
            }

            // convert Number to String here, because we're using the hash code
            // as a Object key
            return hash + '';
        };

        /**
         * Check if a given number is a floating point number
         * @param  {Number} number the number to check
         * @return {Boolean}       true, if the specified number is a floating point number, else false
         */
        that.isFloat = function( number ) {
            if( number === undefined ) {
                return false;
            }

            if( number.constructor !== Number ) {
                return false;
            }

            return number === +number && number !== (number|0);
        };

        /**
         * Internal function for sorting a object by key (if needed) and
         * returning a valid hash value, if the specified object
         * needs a hashing
         *
         * @protected
         * @method hashObject
         * @param  {Object} obj the specified object that'll be processed
         * @return {Object}     a hash string if hashing is needed, else the object itself
         */
        that.hashObject = function( obj ) {
            if( obj.constructor === Object ) {
                // pseudo sorting
                obj = that.sortObjectByKeys( obj );
            }

            if( that.needsHashing( obj ) ) {
                obj = that.getHash( obj );
            }

            return obj;
        };

        return true;
    }

    AbstractCollection.prototype.constructor = AbstractCollection;

    /**
     * Public API definition
     */

    AbstractCollection.prototype.add = function( element ) {};
    AbstractCollection.prototype.get = function( index ) {};
    AbstractCollection.prototype.size = function() {};
    AbstractCollection.prototype.clear = function() {};
    AbstractCollection.prototype.contains = function( element ) {};
    AbstractCollection.prototype.isEmpty = function() {};
    AbstractCollection.prototype.remove = function( index ) {};
    AbstractCollection.prototype.toString = function() {};

    /**
     * Central function to check if an given element needs to be processed
     * with hashing (like Object, Array) or not (e.g. String)
     *
     * @method needsHashing
     * @public
     * @param  {Object} element the element to check
     * @return {Boolean}        true, if element needs hashing
     */
    AbstractCollection.prototype.needsHashing = function( element ) {
        if( element === undefined ) {
            return null;
        }

        if( this.isFloat( element ) ) {
            return true;
        }

        if( element.constructor === String || element.constructor === Number || element.constructor === Boolean ) {
            return false;
        } else {
            return true;
        }
    };

    /**
     * Create a Hash of a given String
     *
     * @method getHash
     * @todo toString() for Numbers and Booleans?
     * @see http://werxltd.com/wp/2010/05/13/javascript-implementation-of-javas-string-hashcode-method/
     * @param  {String} str the String to build a hash on
     * @return {Number}     the actual hash value (non-negative)
     */
    AbstractCollection.prototype.getHash = function( obj ) {
        if( obj !== undefined && obj !== null ) {
            // No hash for functions :(
            if( obj.constructor === Function ) {
                return null;
            }

            // we need a String for hashing
            if( obj.constructor !== String ) {
                return this.hashCode( JSON.stringify( obj ) );
            } else {
                return this.hashCode( obj );
            }
        }

        // and we need a parameter at least :-/
        return null;
    };

    /**
     * Sort the keys in an object by it's keys. Although objects do not
     * have a guaranteed key order, this function will help to identify
     * when two objects are ""equal"".
     *
     * @method sortObjectByKeys
     * @param  {Object} obj the object to sort the keys
     * @return {Object}     sorted object (a copy of the specified one)
     */
    AbstractCollection.prototype.sortObjectByKeys = function( obj ) {
        if( obj !== undefined && obj.constructor === Object ) {
            var objKeys = [],
                sortedObject = {};

            // grab all keys here
            for( var key in obj ) {
                if( obj.hasOwnProperty( key ) ) {
                    objKeys.push( key );
                }
            }

            // using Array.sort() will ensurce an sorted array
            objKeys.sort();

            // ""reimplement"" the keys
            for( var i = 0, iMax = objKeys.length; i < iMax; i++ ) {
                sortedObject[objKeys[i]] = obj[objKeys[i]];
            }

            return sortedObject;
        }

        return null;
    };

    /**
     * Clone Objects, Arrays or date objects
     *
     * @public
     * @method cloneObject
     * @param  {Object} original the element to copy
     * @return {Object}          the copied element
     */
    AbstractCollection.prototype.cloneObject = function( original ) {
        var copy;

        if( original === undefined ) {
            return null;
        }

        if( original.constructor === Array ) {
            copy = [];

            for( var a = 0, aMax = original.length; a < aMax; a++ ) {
                copy[a] = original[a];
            }
        }

        if( original.constructor === Object ) {
            copy = {};
            for( var prop in original ) {
                // when the original object has the given property,
                // do some recursive cloning
                if( original.hasOwnProperty( prop ) ) {
                    // if the value is another object, copy recursive
                    if( original[prop].constructor === Object ) {
                        copy[prop] = this.cloneObject( original[prop] );
                    } else {
                        // else, if the the value is not an object, we can
                        // simply copy the value here
                        copy[prop] = original[prop];
                    }
                }
            }
        }

        if( original.constructor === Date ) {
            copy = new Date();
            copy.setTime( original.getTime() );
        }

        return copy || null;
    };

    // returning the constructor enables us to use the prototypal
    // inheritance and assign the sub class prototype to this
    // constructor
    return AbstractCollection;
} );
"
